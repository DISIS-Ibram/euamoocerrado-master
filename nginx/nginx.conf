error_log /var/log/nginx/error.log warn;

# user www-data;
user nginx;
worker_processes 1;
pid /run/nginx.pid;

events {
    worker_connections 768;
}
http {
    sendfile off;
    tcp_nopush on;
    tcp_nodelay on;
    keepalive_timeout 65;
    types_hash_max_size 2048;
    include /etc/nginx/mime.types;
    default_type application/octet-stream;
    access_log /var/log/nginx/access.log;
    error_log /var/log/nginx/error.log;
    gzip on;
    gzip_disable "msie6";
    server {
        listen 80;
        server_name localhost;

        location /api/ {
            # proxy_pass http://backend/api/;
            proxy_pass http://backend:8686/api/;

            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;

            proxy_redirect off;
            proxy_connect_timeout 20;
            proxy_read_timeout 20;
        }
        location /admin {
            # proxy_pass http://admin/;
            proxy_pass http://admin:8080/;

            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;

            proxy_redirect off;
            proxy_connect_timeout 20;
            proxy_read_timeout 20;
        }
    }
}



# error_log /var/log/nginx/error.log warn;

# # user www-data;
# user nginx;
# worker_processes 1;
# pid /run/nginx.pid;

# events {
#     worker_connections 768;
# }
# http {
#     sendfile off;
#     tcp_nopush on;
#     tcp_nodelay on;
#     keepalive_timeout 65;
#     types_hash_max_size 2048;
#     include /etc/nginx/mime.types;
#     default_type application/octet-stream;
#     access_log /var/log/nginx/access.log;
#     error_log /var/log/nginx/error.log;
#     gzip on;
#     gzip_disable "msie6";
#     server {
#         listen 80;
#         server_name localhost;
#         # location / {
#         #     proxy_pass_header Server;
#         #     proxy_set_header Host $http_host;
#         #     proxy_set_header X-Real-IP $remote_addr;
#         #     proxy_set_header X-Scheme $scheme;
#         #     proxy_set_header X-Real-IP	$remote_addr;
#         #     proxy_set_header X-Forwarded-For	$proxy_add_x_forwarded_for;
#         #     proxy_redirect off;
#         #     proxy_connect_timeout 20;
#         #     proxy_read_timeout 20;
#         #     proxy_pass http://frontend/;
#         # }
#         location /api/ {
#             proxy_pass_header Server;
#             proxy_set_header Host $http_host;
#             proxy_set_header X-Real-IP $remote_addr;
#             proxy_set_header X-Scheme $scheme;
#             proxy_set_header X-Real-IP	$remote_addr;
#             proxy_set_header X-Forwarded-For	$proxy_add_x_forwarded_for;
#             proxy_redirect off;
#             proxy_connect_timeout 20;
#             proxy_read_timeout 20;
#             # proxy_pass http://backend/;
#             proxy_pass http://localhost:8686/;
#         }
#         # location /admin/ {
#         #     proxy_pass_header Server;
#         #     proxy_set_header Host $http_host;
#         #     proxy_set_header X-Real-IP $remote_addr;
#         #     proxy_set_header X-Scheme $scheme;
#         #     proxy_set_header X-Real-IP	$remote_addr;
#         #     proxy_set_header X-Forwarded-For	$proxy_add_x_forwarded_for;
#         #     proxy_redirect off;
#         #     proxy_connect_timeout 20;
#         #     proxy_read_timeout 20;
#         #     # proxy_pass http://admin:$ADMIN_PORT/;
#         #     proxy_pass http://admin:$ADMIN_PORT/;
#         # }
#     }
# }


# ########################################################################


# error_log /var/log/nginx/error.log warn;

# worker_processes 1;
# pid /run/nginx.pid;

# events {
#     worker_connections 768;
# }

# http {
#     client_max_body_size 100M;
#     tcp_nopush on;
#     tcp_nodelay on;
#     keepalive_timeout 65;
#     types_hash_max_size 2048;
#     include /etc/nginx/mime.types;
#     default_type application/octet-stream;
#     #access_log /var/log/nginx/access.log;
#     error_log /var/log/nginx/error.log;
#     gzip on;
#     gzip_disable "msie6";

#     proxy_cache_path /etc/nginx/cache levels=1:2 keys_zone=my_cache:10m max_size=1g;


#     server {
#         listen 80;
#         server_name _;

#         location /api/media/ {
#             proxy_pass http://media_service:5000/media/;
#             proxy_set_header Host $host;
#             proxy_set_header X-Real-IP $remote_addr;
#             proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#             proxy_set_header X-Forwarded-Proto $scheme;
#         }

#         location /api/thumb/ {
#             proxy_pass http://media_service:5000/thumb/;
#             proxy_set_header Host $host;
#             proxy_set_header X-Real-IP $remote_addr;
#             proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#             proxy_set_header X-Forwarded-Proto $scheme;
#             proxy_set_header X-Query-String $is_args$args;
#         }

#         location / {
#             proxy_pass http://frontend;
#             proxy_http_version 1.1;
#             proxy_set_header Upgrade $http_upgrade;
#             proxy_set_header Connection 'upgrade';
#             proxy_set_header Host $host;
#             proxy_cache_bypass $http_upgrade;
#             proxy_set_header X-Real-IP $remote_addr;
#             proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#             proxy_set_header X-Forwarded-Proto $scheme;
#         }


#         location /graphql {
#            #resolver impede que o nginx pare se não acha o servico
#             # resolver 127.0.0.1 valid=5s;
#             proxy_no_cache 1;
#             proxy_cache_bypass 1; 
#             proxy_set_header Host $http_host;
#             # proxy_set_header X-Real-IP $remote_addr;
#             # proxy_hide_header Access-Control-Allow-Origin;
#             # add_header Access-Control-Allow-Origin $http_origin always;
#             # proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#             # proxy_set_header X-Forwarded-Host $host;

#             # sub_filter 'http://localhost/api/'  'http://localhost:8080/api/';
#             #sub_filter 'href="/static/'  'href="/api/static/';
#             sub_filter_once off;
            
#             # proxy_pass http://backend/api;
            
#             proxy_pass  http://hassura/v1/graphql;
#         }

#         location /hassura {
#             #resolver impede que o nginx pare se não acha o servico
#             # resolver 127.0.0.1 valid=5s; - não dando certo
#             proxy_no_cache 1;
#             proxy_cache_bypass 1; 
#             proxy_set_header Host $http_host;

#             sub_filter_once off;
#             # set $hassura hassura/v1/graphql;
            
#             proxy_pass  http://hassura/;
#         }

#     }

# }
